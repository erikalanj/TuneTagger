{% extends 'base.html' %} {% block body %}
<div class="lighting-mode">
  <h3 id="lighting-mode-header">Dark Mode</h3>
  <label class="switch" id="lighting-mode-toggle">
    <input type="checkbox" />
    <span class="slider"></span>
  </label>
</div>

<div class="container">
  <h1 id="title">Welcome to TuneTagger!</h1>

  <h2>For music fans to organize their library by moods, not genres</h2>

  <div class="section">
    <h4>
      Would you like to add a song to your library?
      <span class="arrow">▼</span>
    </h4>

    <div class="content">
      <form action="/api/add-song" method="post" id="song-form">
        <label for="title-to-insert">Enter song title</label>
        <input type="text" name="title-to-insert" id="title-to-insert" />
        <label for="artist-to-insert">Enter artist</label>
        <input type="text" name="artist-to-insert" id="artist-to-insert" />
        <input type="submit" id="submit-insertion" value="Add song! :D" />
        <div id="checkmark" class="checkmark">&#10003;</div>
      </form>
    </div>
  </div>

  <div class="section">
    <h4>See your current library! <span class="arrow">▼</span></h4>

    <div class="content">
      <div class="filter-controls">
        <form action="{{ url_for('index')}}" method="GET" id="mood-filter-form">
          <label for="mood=select"
            >Filter by Moods (Ctrl/Cmd Click to select multiple):</label
          >

          <select name="filter_moods" id="mood_select" multiple>
            {% for mood in available_moods %}
            <option
              value="{{ mood }}"
              {%
              if
              mood
              in
              selected_moods%}selected{%
              endif
              %}
            >
              {{ mood }}
            </option>
            {% endfor %}
          </select>

          <button type="submit" id="filter-apply">Apply filter</button>
        </form>
      </div>
      <div id="library-output" class="library-table">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Song Title</th>
              <th>Artist Name</th>
              <th>Mood</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for index, row in library_data.iterrows() %}
            <tr>
              <td>{{ row['#'] }}</td>
              <td>{{ row['Song Title'] }}</td>
              <td>{{ row['Artist Name'] }}</td>
              <td>{{ row['Mood'] }}</td>
              <td>
                <form
                  method="POST"
                  action="/api/delete-song"
                  class="delete-form"
                >
                  <input
                    type="hidden"
                    name="id-to-delete"
                    value="{{ row['ID'] }}"
                  />
                  <button type="submit">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/collapsible.js') }}"></script>
  <script src="{{ url_for('static', filename='js/library.js') }}"></script>
  <script src="{{ url_for('static', filename='js/forms.js') }}"></script>
  <script src="{{ url_for('static', filename='js/lighting_toggle.js') }}"></script>

  <script>
    // Initialize everything when DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      initCollapsibleSections();
      restoreSectionStates();
      initAllForms();
    });
  </script>

  {% endblock %}
</div>
